<app-loading [isLoading]="isLoading"></app-loading>
<div class="card card-custom gutter-b">
  <div class="card-header p-4">
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="card-label font-weight-bolder text-dark mr-10">
        {{ classInfo.className }}
      </h3>
    </div>
    <div class="card-toolbar">
      <button type="button" class="btn btn-light" (click)="back()"><i class="fa fa-arrow-left"></i>Quay lại</button>
    </div>
  </div>
  <div class="card card-custom">
    <div class="card-header card-header-tabs-line">
      <ul class="nav nav-dark nav-bold nav-tabs nav-tabs-line" role="tablist">
        <li class="nav-item">
          <a (click)="setActiveTab(1)" class="nav-link cursor-pointer" [ngClass]="getActiveTabCSSClass(1)" role="tab"> Thông tin chung </a>
        </li>
        <li class="nav-item">
          <a (click)="setActiveTab(2)" class="nav-link cursor-pointer" [ngClass]="getActiveTabCSSClass(2)" role="tab"> Chương trình học </a>
        </li>
        <li class="nav-item">
          <a (click)="setActiveTab(3)" class="nav-link cursor-pointer" [ngClass]="getActiveTabCSSClass(3)" role="tab"> Danh sách học sinh </a>
        </li>
      </ul>
    </div>
    <div class="card-body pt-2">
      <div class="tab-content pt-3 pl-3">
        <div class="tab-pane mb-5" [ngClass]="getActiveTabCSSClass(1)">
          <div>
            <h4 class="mb-5 custom-title">THÔNG TIN LỚP HỌC</h4>
            <div class="row">
              <div class="col-xl-12">
                <table class="table table-head-custom table-vertical-center overflow-hidden table-borderless">
                  <thead>
                    <th class="p-0" [style.width]="'200px'"></th>
                    <th class="p-0"></th>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="border-top-0">Năm học</td>
                      <td class="border-top-0">{{ classInfo.year }}</td>
                    </tr>
                    <tr>
                      <td>Level</td>
                      <td>
                        {{ classInfo.grade }}
                      </td>
                    </tr>
                    <tr>
                      <td>Sĩ số</td>
                      <td>
                        {{ classInfo.studentCount }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div>
            <h4 class="mt-5 mb-5 custom-title">KẾ HOẠCH GIẢNG DẠY</h4>
            <div class="row">
              <div class="col-xl-12">
                <table class="table table-head-custom table-vertical-center overflow-hidden table-borderless">
                  <thead>
                    <th class="p-0" [style.width]="'200px'"></th>
                    <th class="p-0"></th>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="border-top-0">Chương trình học</td>
                      <td class="border-top-0">
                        {{ teachingPlan.programName }}
                      </td>
                    </tr>
                    <tr>
                      <td>Ngày bắt đầu</td>
                      <td>
                        {{ teachingPlan.dateStart | date : 'dd/MM/yyyy' }}
                      </td>
                    </tr>
                    <tr>
                      <td>Tiến độ giảng dạy(bài)</td>
                      <td>
                        {{ teachingPlan.teachingProcess }}
                      </td>
                    </tr>
                    <tr>
                      <td>Ngày học</td>
                      <td>
                        {{ teachingPlan.dayStudyName }}
                      </td>
                    </tr>
                    <!-- <tr>
                      <td>Giờ học</td>
                      <td>
                        {{ teachingPlan.studyTime }}
                      </td>
                    </tr> -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-pane" [ngClass]="getActiveTabCSSClass(2)">
          <div>
            <a href="javascript:;" (click)="open(ProgramDetail)" class="a-custom">Xem thông tin về chương trình</a>
            <div class="mt-4">
              <app-topic-list [programId]="teachingPlan?.programId" (description)="getDesc($event)"></app-topic-list>
            </div>
          </div>
        </div>
        <div class="tab-pane" [ngClass]="getActiveTabCSSClass(3)">
          <button type="button" class="btn btn-outline-secondary mb-2" *ngIf="students.length > 0" (click)="exportExcel()">
            <i class="ki ki-long-arrow-down"></i>Tải về
          </button>
          <div class="table-responsive angular-bootstrap-table">
            <table class="table table-head-bg table-vertical-center overflow-hidden">
              <thead>
                <tr>
                  <th style="min-width: 20px">STT</th>
                  <th style="min-width: 100px">Ảnh</th>
                  <th style="min-width: 100px">HỌ TÊN</th>
                  <th style="min-width: 100px">MÃ HỌC SINH</th>
                  <th style="min-width: 100px">GIỚI TÍNH</th>
                  <th style="min-width: 100px">NGÀY SINH</th>
                  <th style="min-width: 100px">PHỤ HUYNH</th>
                  <th style="min-width: 100px">SĐT PHỤ HUYNH</th>
                  <th style="min-width: 100px" *ngIf="checkGuard">HÀNH ĐỘNG</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let student of students; let i = index">
                  <th scope="row">{{ i + 1 }}</th>
                  <td>
                    <img src="{{ student.studentMainImage ?? defaultImageUrl }}" style="width: 75px; height: 75px; object-fit: cover" />
                  </td>
                  <td>
                    <a (click)="goStudentDetail(student.id, 'view')" href="javascript:;">
                      {{ student.name }}
                    </a>
                  </td>
                  <td>{{ student.code }}</td>
                  <td>{{ student.gender == 1 ? 'Nam' : 'Nữ' }}</td>
                  <td>{{ student.dob | date : 'dd/MM/YYYY' }}</td>
                  <td>{{ student.parentName }}</td>
                  <td>{{ student.phoneNumber }}</td>
                  <td *ngIf="checkGuard">
                    <a title="Edit structure" (click)="goStudentDetail(student.id, 'edit')" href="javascript:;">
                      <span
                        [inlineSVG]="'./assets/media/svg/icons/Communication/Write.svg'"
                        cacheSVG="true"
                        class="svg-icon svg-icon-md svg-icon-primary"
                      >
                      </span>
                      Chỉnh sửa thông tin
                    </a>
                    <button
                      *ngIf="student.studentMainImage == null"
                      type="button"
                      class="btn btn-outline-secondary mr-2 ml-2"
                      (click)="fileInput.click()"
                    >
                      <span> Tải lên ảnh học sinh </span>
                      <input #fileInput type="file" (change)="upload($event, student.id)" style="display: none" />
                    </button>

                    <a
                      title="Xoá"
                      href="javascript:;"
                      *ngIf="student.studentMainImage != null"
                      class="text-danger ml-2"
                      (click)="openRemoveStudentMainImageModal(student.id, student.name)"
                    >
                      Xóa ảnh học sinh
                    </a>

                    <a title="Xoá" href="javascript:;" class="text-danger" (click)="openRemoveStudentModal(student.id, student.name)">
                      <span [inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'" class="svg-icon svg-icon-md svg-icon-danger svg-icon-2x">
                      </span
                      >Xóa
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
            <app-empty-table [length]="students?.length" [height]="100" text="Không có học sinh nào."> </app-empty-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #ProgramDetail let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4>Mô tả chương trình học</h4>
  </div>
  <div class="modal-body">
    <div class="wraper" *ngFor="let desc of descriptionTypes">
      <h5>{{ desc.label }}</h5>
      <div [innerHTML]="desc.value"></div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('Close click')">Đóng</button>
  </div>
</ng-template>
<common-modal #confirmationModal (newConfirmationEvent)="getConfirmationValue($event)"> </common-modal>
